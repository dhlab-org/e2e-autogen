# 🤖 E2E Autogen

Google 스프레드시트 기반 시나리오를 Playwright 테스트 **스텁 코드**로 자동 생성하는 CLI 도구입니다.

## ✨ 주요 기능

- 🌐 **Google Sheets 연동**: 서비스 어카운트 인증으로 시트를 안전하게 불러옵니다
- 🔍 **멀티 시트 자동 처리**: `[TC-x]` 시트를 자동 감지하여 한 번에 변환합니다
- 🧪 **Playwright 스텁 생성**: 시나리오 기반 테스트 코드 틀을 즉시 생성합니다
- 🚀 **간편 CLI**: 한 줄 명령으로 손쉽게 실행할 수 있습니다
- 📝 **결과 자동 업데이트**: 테스트 실행 결과를 Google Sheets에 자동으로 업데이트 (TBD)

> 💡 **스텁 코드(Stub Code)란?**  
> 실제 구현 로직은 없지만 기본 구조와 가이드 주석이 포함된 코드 틀입니다.  
> 개발자는 생성된 틀에 실제 테스트 로직만 추가하면 됩니다.

## 📦 설치

> [!IMPORTANT]  
> 현재 npm 배포 전 단계이므로, 로컬에서 직접 빌드하여 사용해야 합니다.

```bash
# 1. 저장소 클론
git clone https://github.com/dhlab-org/e2e-autogen.git
cd e2e-autogen

# 2. 의존성 설치
yarn install

# 3. 프로젝트 빌드
yarn build

# 4. 전역 링크 생성
npm link
```

> **💡 팁**: `npm link` 실행 후 터미널 어디서든 `e2e-autogen` 명령어를 사용할 수 있습니다.

### 🔍 설치 확인

설치가 정상적으로 완료되었는지 확인해보세요:

```bash
# 버전 정보 확인
e2e-autogen --version

# 사용법 확인
e2e-autogen --help
```

## 📊 Google Sheets 연동 설정

### 1️⃣ 서비스 어카운트 설정

Google Sheets API를 사용하기 위해 서비스 어카운트 인증이 필요합니다:

```bash
# 인증 파일 디렉토리 생성
mkdir -p playwright/.auth

# 노션에 있는 credentials.json 내용을 복사하여 다음 위치에 저장
# playwright/.auth/credentials.json
```

> **💡 인증 파일 준비 방법**
>
> - 팀 계정으로 생성된 서비스 어카운트를 사용합니다
> - 노션에서 `credentials.json` 파일 내용을 복사하여 저장하세요

### 2️⃣ 스프레드시트 데이터 구조

팀 공통 QA 시트를 이용해주세요.  
스프레드시트는 다음과 같은 컬럼 구조로 이루어져 있습니다.

| 컬럼              | 설명                                     | 예시                                          |
| ----------------- | ---------------------------------------- | --------------------------------------------- |
| A (시나리오 ID)   | 테스트 시나리오 식별자                   | TC-1.1                                        |
| B (e2e 시나리오)  | 시나리오 설명                            | 질문 입력                                     |
| C (UI path)       | 테스트 대상 UI 경로                      | 홈 / 입력창                                   |
| D (action/when)   | 테스트 액션 또는 조건                    | 메인화면 로드                                 |
| E (expected/then) | 기대 결과                                | 질문 입력창이 정상적으로 표시                 |
| F (테스트 ID)     | 개별 테스트 스텝 식별자                  | TC-1.1.1                                      |
| G (Tag)           | 어떤 맥락에서 나온 테스트케이스인지 기록 | `default`, `bugfix`, `new`                    |
| H (Comment)       | 자유롭게 작성                            |                                               |
| I~ (결과 컬럼)    | 테스트 실행 결과 (자동 업데이트)         | `pass`, `fail`, `not_executed`, `manual_only` |

### 3️⃣ 스프레드시트 공유 설정

1. Google Sheets에서 테스트할 스프레드시트를 엽니다
2. **공유** 버튼 클릭
3. 노션에 안내된 서비스 어카운트 이메일을 **Editor** 권한으로 추가
4. 스프레드시트 URL을 복사합니다 (URL에 포함된 gid가 특정 시트를 지정합니다)

## 🚀 사용법

### 💻 CLI 명령어

```bash
# 스프레드시트 전체에서 [TC-x] 시트 자동 처리 (추천)
e2e-autogen https://docs.google.com/spreadsheets/d/[SPREADSHEET_ID]/edit

# 특정 시트(gid)만 처리
e2e-autogen https://docs.google.com/spreadsheets/d/[SPREADSHEET_ID]/edit#gid=[GID]

# 출력 디렉토리 지정
e2e-autogen https://docs.google.com/spreadsheets/d/[SPREADSHEET_ID]/edit --output ./playwright/__generated-stub__

# 도움말 보기
e2e-autogen --help

# 버전 확인
e2e-autogen --version
```

### ⚙️ 옵션

- `<url>`: Google Sheets 스프레드시트 URL (필수)
  - gid가 **없으면** `[TC-x]` 패턴 시트를 자동 감지하여 모두 처리
  - gid가 **있으면** 해당 시트만 처리
- `--output <dir>`: 생성된 테스트 파일을 저장할 디렉토리 (기본값: `./__generated__/playwright`)
- `--help`, `-h`: 도움말 표시
- `--version`, `-v`: 버전 정보 표시

### 🔗 외부 프로젝트에서 사용

package.json에 스크립트를 추가하여 사용할 수 있습니다:

```json
{
  "scripts": {
    "generate-e2e": "e2e-autogen https://docs.google.com/spreadsheets/d/[SPREADSHEET_ID]/edit#gid=[GID] --output ./playwright/__generated-stub__"
  }
}
```

실제 사용 예시:

```bash
yarn generate-e2e
```

## 🎯 생성된 테스트 코드 예시

Google Sheets 데이터에서 다음과 같은 Playwright 테스트 스텁 코드가 생성됩니다:

```typescript
// 📝 Auto-generated by E2E-Autogen
// 🔧 Generated from: TC-1.1

import { test } from "@playwright/test";

test("[TC-1.1] 질문 입력", async ({ page }) => {
  await test.step("[TC-1.1.1] 메인화면 로드 -> 질문 입력창이 정상적으로 표시", async () => {
    // 📍 UI Path: 홈 / 입력창
    // 🎬 When: 메인화면 로드
    // ✅ Then: 질문 입력창이 정상적으로 표시
  });

  await test.step("[TC-1.1.2] 질문 입력창에 문자 입력 -> 정상적으로 입력됨", async () => {
    // 📍 UI Path: 홈 / 입력창
    // 🎬 When: 질문 입력창에 문자 입력
    // ✅ Then: 정상적으로 입력됨
  });

  await test.step("[TC-1.1.3] 입력 완료 -> 전송 버튼 활성화", async () => {
    // 📍 UI Path: 홈 / 입력창
    // 🎬 When: 입력 완료
    // ✅ Then: 전송 버튼 활성화
  });
});
```

> **💡 스텁 코드 특징**
>
> - 각 테스트 케이스는 여러 스텝으로 구성됩니다
> - 실제 구현 로직은 포함되지 않으며, 개발자가 직접 추가해야 합니다 (playwright test generator를 활용하면 빠르게 작성 가능합니다.)
> - Given/When/Then 패턴을 따르는 BDD 스타일 주석이 포함됩니다
> - 테스트 실행 후 결과가 자동으로 Google Sheets에 업데이트됩니다 (향후 기능)

## 📁 생성된 파일 구조

```
<output-directory>/
└── TC-1.stub.ts   # sheetId(대분류)별 테스트 파일
```

## 🔮 향후 기능

### 📊 테스트 결과 자동 업데이트

테스트 실행 결과를 Google Sheets에 자동으로 업데이트하는 기능입니다:

**📍 결과 기록 방식**

- **위치**: 기존 컬럼(A~H) 다음에 결과 컬럼들이 자동으로 추가됩니다
- **구조**: 결과 + 실행 날짜/시간 컬럼으로 구성됩니다
- **색상 구분**: 결과에 따라 자동으로 색상이 적용됩니다
- **드롭다운**: 결과 컬럼에는 선택 가능한 드롭다운 메뉴가 제공됩니다

**🎯 지원 결과 유형**

- ✅ `pass`: 테스트 성공
- ❌ `fail`: 테스트 실패
- ⚠️ `flaky`: 불안정한 테스트 (일부 성공, 일부 실패)
- ⏭️ `not_executed`: 미실행
- 📝 `manual_only`: 수동 테스트만 가능

**⚡ 자동화 기능**

- **실시간 업데이트**: Playwright 테스트 실행 후 결과가 즉시 시트에 반영
- **이력 관리**: 실행 날짜와 시간을 `YYYYMMDD:HH:mm` 형식으로 기록
- **시트별 처리**: `[TC-x]` 패턴의 시트를 자동 감지하여 각각 업데이트
- **결과 통계**: 테스트 ID별로 성공/실패 횟수를 집계하여 상태 결정

**🔧 사용 방법**

```bash
# 테스트 결과 업데이트
e2e-autogen update --sheets "https://docs.google.com/..." \
                   --results ./playwright/reporters/results.json
```

> **💡 주의사항**
>
> - 서비스 어카운트에 **Editor** 권한이 필요합니다
> - Playwright JSON 리포터 결과 파일이 필요합니다
> - 각 시트는 `[TC-x]` 형식으로 작성되어야 합니다

## 📄 라이선스

MIT © dhlab-fe
